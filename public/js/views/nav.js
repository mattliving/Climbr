// Generated by CoffeeScript 1.3.3
(function() {

  define(["jquery", "underscore", "backbone", "text!templates/mainNav.html", "text!templates/subNav.html", "bootstrap", "jqueryui/slider"], function($, _, Backbone, mainNav, subNav) {
    var NavView;
    NavView = Backbone.View.extend({
      el: $("body"),
      grades: ["3", "4", "5a", "5b", "5c", "6a", "6a+", "6b", "6b+", "6c", "6c+", "7a", "7a+", "7b", "7b+", "7c", "7c+", "8a", "8a+", "8b", "8b+", "8c", "8c+", "9a", "9a+", "9b", "9b+"],
      mainNavTemplate: _.template(mainNav),
      subNavTemplate: _.template(subNav),
      events: {
        "click .dropdown-menu li a": "toggleActive",
        "submit #searchField": "triggerSearch",
        "click #searchBtn": "triggerSearch"
      },
      initialize: function() {
        var self;
        this.render();
        this.searchField = $("#searchField");
        $(".dropdown-toggle").dropdown();
        this.initTypeahead();
        self = this;
        $("#slider-range").slider({
          range: true,
          min: 0,
          step: 30,
          max: 780,
          values: [0, 780],
          slide: function(event, ui) {
            return $("#gradeLabel .label.label-important").text(self.calcGrade(ui.values[0]) + " - " + self.calcGrade(ui.values[1]));
          }
        });
        return $("#gradeLabel .label.label-important").text("3 - 9b+");
      },
      initTypeahead: function() {
        return $.ajax({
          url: "/api/typeahead",
          type: "get",
          success: function(data) {
            return $("#searchField").typeahead({
              source: data
            });
          }
        });
      },
      render: function() {
        this.$el.append(this.mainNavTemplate);
        this.$el.append(this.subNavTemplate);
        return this;
      },
      toggleActive: function(e) {
        var $this;
        $this = $(e.currentTarget);
        if (!$this.hasClass("active")) {
          $this.addClass("active");
          return $this.html("<i class='icon-ok'></i>" + $this.text());
        } else {
          $this.removeClass("active");
          return $this.html($this.text());
        }
      },
      triggerSearch: function(e) {
        e.preventDefault();
        return this.dispatcher.trigger("submit:search", this.searchField.val());
      },
      calcGrade: function(value) {
        return this.grades[26 - (780 - value) / 30];
      }
    });
    return NavView;
  });

}).call(this);
